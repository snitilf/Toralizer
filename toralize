#!/bin/bash
#
# toralize - wrapper script to route any command through tor
#
# usage: ./toralize <command> [args...]
# example: ./toralize curl http://ipinfo.io/ip

# get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# path to the toralize.dylib library
LIB_PATH="${SCRIPT_DIR}/toralize.dylib"

# check if the library exists
if [ ! -f "$LIB_PATH" ]; then
    echo "error: toralize.dylib not found"
    echo "please run 'make' first to build the library"
    exit 1
fi

# check if a command was provided
if [ $# -eq 0 ]; then
    echo "usage: $0 <command> [args...]"
    echo ""
    echo "example:"
    echo "  $0 curl http://ipinfo.io/ip"
    echo "  $0 ssh user@example.com"
    echo "  $0 wget http://example.com"
    exit 1
fi

# export the DYLD_INSERT_LIBRARIES environment variable
# this tells macOS to load our library before running the command
export DYLD_INSERT_LIBRARIES="$LIB_PATH"

# execute the command with all its arguments
exec "$@"

